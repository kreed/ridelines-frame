name: Deploy to Production

run-name: Deploy prod - ${{ inputs.bundle_version }}

on:
  workflow_dispatch:
    inputs:
      bundle_version:
        description: 'Bundle version to deploy'
        required: true
        type: string

permissions:
  contents: write
  packages: write
  id-token: write
  actions: write

jobs:
  pre-deployment:
    name: Pre-deployment Review
    runs-on: ubuntu-latest
    steps:
      - name: Show staging release for review
        run: |
          echo "## Production Deployment Pending" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“‹ **Review staging release**: [prod-${{ inputs.bundle_version }}](${{ github.server_url }}/${{ github.repository }}/releases/tag/prod-${{ inputs.bundle_version }})" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“¦ **Bundle version**: ${{ inputs.bundle_version }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Please review the staging release above before approving deployment." >> $GITHUB_STEP_SUMMARY

  deploy:
    name: Deploy to Production
    needs: pre-deployment
    uses: ./.github/workflows/base-deploy.yml
    with:
      environment: prod
      bundle_version: ${{ inputs.bundle_version }}
    secrets: inherit